---
title: Hub复盘会议
date: 2020-01-02 10:10:59
permalink: /pages/f6b0e7/
categories:
  - 公司事务
---
# Hub 经验总结

[TOC]  

hub是一款解决数据汇聚、融合、清洗、开放的产品（大部分功能很像 kettle），自从2017年年初开始了hub相关开发，截止 2020/10/20 已经完成了三期开发，第四期刚刚提上日程，其中一期是预研，二期是初探，三期初步产品，四期是最终形态。具体介绍如下：

- 2017年年初开始hub第一个版本，这个版本的目标是完成数据抽取的预研，就一个系统，整体功能就是借助 kafka 完成从 MySQL、Oracle 中抽数据到 MySQL、Oracle，具体功能主要有：1.kafka、zookeeper集群管理可视化；2.数据库连接管理；3.日志管理；4.集群监控。这个版本产品定位有问题，首先我们定位的不是卖产品，是卖服务、然后仅仅提供简单的数据抽取，只有一个抽取数据的系统无其它功能；

- 2018 年开始第二个版本开发，这个版本目标是探索hub的这个架构体系，定义了DI设计器、作业管理器、权限系统、日志管理、运维监控、数据资源库、实时交换、目录管理、交换门户九个系统，然后把数据抽取的配置可视化，方便用户操作。除了设计器其它系统都实现了前后端分离，部分系统实现了 docker 部署，最后因为人员变动、功能复杂，没有完成全部子系统的开发；

- 2019年年初开始第三个版本开发，这个版本的目标是：修改之前的问题、增强用户体验、提升用户获得感，新增了一个系统：前端治理系统，然后重写DI设计器、数据资源库等，完善了之前没做完的系统。这个版本整体都实现了 CI/CD；

- 2020年开始四期预研，因为夹杂了疫情、低代码平台、DI-Studio 等等，一直到 2020年十月份底才开始新版本需求探索，这个版本又想把多个子系统组合成一个大系统。在三期的基础上，四期把 docker-swarm 换成了 k8s，调度平台把基于 mesos 换成了基于 k8s，前端做成了一个系统，四期想在之前的基础上通过低代码平台、DI-Studio 等等做一个巨无霸产品。截止 2020/10/20 有了初步概念，具体还很纠结，all-in-one 太复杂了，说不定还得重新组合；

本文整个 HUB 复盘会议上我的观点、建议汇总，我把它整理起来希望能够为别的开发人员、管理人员提供经验。

> 一句话总结：凡是能够通过编程解决的问题都不是问题！

## 二期复盘留存

 在第二个版本完成和第三个版本开始前，发起这次会议，目的是：1.总结之前好的经验，继续发扬；2.总结之前的不足，提出改进方案；3.提出下一阶段的目标、优先级。

### Hub二期缺陷分析

Hub二期和三期测试的系统中，缺陷总计算：500，其中一部分是老版本的信息交换涉及的系统，去除这部分HUB二期前后端总缺陷410。这410个去除小虎为了测试报告好看一点造的或者复制的11个，还有399个问题，涉及到五个系统，其中DI设计器：174、用户权限：74、运维监控：65、作业管理器：47、实时接收：39。分布如下：
![图片](https://gitee.com/leixiaoai/markdown/raw/master/03.公司事务/images/hub/hub.png )

 因为缺陷提出时间太过久远，很多问题无法区分是前端问题、后端问题还是前后端共同造成的问题。所以我只能大致看了一下Hub二期生态涉及到的问题，其中：

- 1.总体而言前后端不分离技术、项目复杂度、需求频繁变更、预研不充分导致DI设计器成为开发时间最长、问题最多的项目。DI设计器后端的问题主要集中在数据库类型的适配，前端的很多问题都是技术选型引起的。前端开发以单表输出问题最多、耗时最长，它经历了两个版本，过多转换逻辑放在前端，前后端适配不一致，逻辑过于复杂应该由后端提供接口，前端去调用。还有就是开发环境频繁变动，以Hbase组件为例，开始由子龙提供了一个虚拟机，开发到一半，虚拟机出问题了，这个组件就没有开发了；

- 2.用户权限是整个Hub系统中唯一一个能够影响到其它系统的子系统，这个系统共计74个问题，其中基础管理模块的三个页面前后端问题差不多30个，基础管理的三个页面是在没有设计稿的情况下编写的，另外后端也没有很好的理解这三个页面的作用，这三个页面问题占权限系统的40%。另外权限系统的单点登录间接给问题总数贡献了15个到17个问题；

- 3.权限系统和实时接收系统的问题有很大一部分是前后端没有很好沟通造成的，比如yapi上的接口和实际接口不一致或者根本就没有很好的接口说明文档，以后如果遇到这种问题应该及时终止开发，不终止开发出来的系统修改时间都比开发时间长。所有问题中有35个左右是显示问题或者交互问题，例如文本太长显示问题、默认值、风格不统一、设计人员没有考虑图表极端状况等，这里面很多都能避免；

- 4.看完缺陷发现有一部分缺陷是测试人员对系统不理解造成的，以用户权限为例，未经审核的用户不允许登录，这是权限系统中用户使用的前提，但是测试人员完全不知道，最后浪费了大量时间测试出了很多不是问题的问题，此时需要一种方式来告诉测试人员项目的流程；

在开发过程中耗时比较长的修改我印象当中有：

- 1.最开始的一次是18年年初，数据源相关数据库修改。我们把数据源的相关的几张表和组件实例表合并，这次修改改变了程序的数据结构，并且最后发现这种改变是错误的。改进办法：程序=数据结构+算法，数据结构变更可能会导致整个程序要重写，如果有这样的变更应该尽可能的在设计阶段避免；另外数据库设计违背了设计原则，这种变更居然也能得到开发人员的同意！当时有开发人员提出异议，最后被项目经理驳回（还有一个原因就是前面提到的开发人员都想着先实现，后面再优化，结果这是错的，没法优化，只能重写），如果项目经理没有技术基础，建议别插手代码的实现，还有就是公司需要一个技术主管，负责将需求转换成技术。

- 2.用户权限集成，我们开发Hub子系统的时候一直就想着“先把当前系统开发完成，权限系统等之后开发完了集成一些就好了”，这种想法让我们没有去思考系统之间的联系，就算时间再急迫，也需要先理清系统联系，在开发子系统的过程中预留一些字段。集成权限的时候发现子系统没有字段存储用户信息，加上权限之后很多代码都得修改，这样做项目的整体开始速度反而降低了。现在还有一个问题，所有权限都在前端，这是整个权限系统不合理的地方。软件工程有六个生命周期：需求、设计、编码、测试、运维，越早发现问题修改成本越低，这种集成方式存在严重不合理的地方。

- 3.在集成权限系统之后，单点登录又成了一个老大难，自从hub二期第七个版本开始子系统都陆陆续续集成单点登录，到现在单点登录就是一个噩梦，简直就是一个魔咒，第七个版本之后到现在每次测试的问题里面都有单点登录的影子。这个原因还是技术选型和预研不深入引起的，我们一直忙于开发各种系统，开发的时候就想着“以后优化”、“以后预研”，这种思维迟早会害死整个项目的。另外对于一些技术的选型一定要有一定的了解，充分的预研，不能因为它功能强大就用，技术选型还得建立在需求之上，这样太过冒进。改进办法：1.技术的预研一定要明确目标，带着需求去预研；2.预研的结果一定要写个demo展示，让大家都知道这个新技术的好处和能解决的问题；3.预研一定要有输出，包括文档、代码、踩坑笔记等；4.预研的输出一定要维护，不断更新，同时负责预研的人一定要跟进整个团队使用新技术的进展。

- 4.另外还有就是抽取其它用户、schema下表的数据，当然如果对现场环境了解充分的话可以减少很多麻烦。建议实施人员和公司项目团队之间建立一种高效、体系化的沟通方式，需要保证现场的情况能够得到有效的反馈，然后这些问题必须反馈给项目经理或者高层领导，不然开发人员对项目没有信心，结果高层领导以为什么都做完了拿出去到处吹嘘，最终所有功能都没实现，另外建议领导出去吹嘘的时候先问一下开发人员这些功能合不合理。

### 项目管理相关问题

- 1.评审、会议前给充足的时间准备，从去年到今年准备了很多次评审，也组织了很多次会议，每次都是开会前半个小时或者前几分钟才召集会议参与人员，这样没有时间准备，因为“信息不对称”，参会人员得花大量时间消化会议内容，没法在会议中提出建设性意见。按照CMMI5规范，评审前提前1-3天将评审文档发给评审人员，收集评审问题记录在预评审意见表中，先确定初步解决方案，然后才是评审会议。

- 2.补充之前提到的“信息不对称”。以用户权限的基础管理为例，在开发过程中产品没有把基础管理的整个逻辑给开发人员解释清楚，等到字典管理开发的时候，前端使用字典名存储字典中文信息、字典值存储代码，后端使用字典值存储中文，字典名存储根节点字典中文，测试的时候前端使用自己的逻辑完成测试，然后测试也通过了。再之后为了丰富系统数据，后端造了一些数据，等到部署之后字典相关功能都出错了。还有更严重的，之前开发项目，开发完成了才知道这个项目是做什么的，现在没以前那么严重了，但是问题没有彻底解决。团队中每个人都有不同的生活环境，这些环境会影响每个人的思维，造成了他们对问题理解不一致，此时需要保证团队成员对方向的理解是一致的。

- 3.项目版本和项目变更没有有效地管理起来，作为开发人员，我都不知道现场部署的是哪一个版本，我只知道是一个很老很老的版本，我们一直疲于写代码，实现各种功能，疏忽了项目管理。记得之前一个周六实施人员在公司部署项目是遇到了一个问题叫我看看，我立马赶到了公司，结果发现后端数据库变更了，之前约定开发人员将所有变更反馈给项目经理，由项目经理记录变更，结果没有一次按照这种规则做，看到这种情况我都快疯了，这已经不是编程能力好坏的问题了，我们做了这么多努力、提了这么多建议，最后却没有人执行，那这次会议还有意义吗？总结历史的经验难道是为了不停地重蹈历史的覆辙吗？实在没法保证这些建议的实现，我建议项目管理办抽一个人，他什么都不做，就保证项目按照规范执行。

- 4.如何将个人经验转换成团队经验？在项目开发中每个人都有自己对编程的体悟，我们需要定期召开分享会，将这些经验和建议转换成团队的经验，我们也需要成果的积淀，公司有个财富库，这个没人维护了，建议前端开发人员将自己重复的功能抽取出来开发成公共组件，存储到 npm 和github，后端开发人员将自己可复用代码抽取出来，提交到公司的 maven 私服和 GitHub。

- 5.新人的培养。今年公司陆陆续续来了不少新员工，他们能力参差不齐，我们需要一个体系化的新员工培养计划，保证他们能够实现我们的功能需求，编写高质量的代码。我们需要引进代码更加严格的审查机制，建议使用sonar和之前存在的组内互查结合的方式保证代码质量。

### 协作相关问题

协作主要是在团队成员之间发生，团队成员主要由开发、产品、运维、测试这几部分组成，协作应该建立在对产品的了解和契约之上。首先是参与人员必须充分了解产品，对产品都不了解怎么合作呢？对产品充分了解之后另外还需要契约，契约保证了协作的质量，契约包括各种规范、文档。开发人员内部的契约就是编码规范、各种约束，前后端之间应该有接口规范、接口文档，开发和运维之间应该有版本变更说明、变更的产出、问题反馈等。测试不知道需求、不了解整个流程，没法测试，我看他们提的问题完全是避重就轻。这是个大问题，我现在的面没那么广，只知道要规范、契约，其它还不知道怎么解决。

## 三期复盘草稿

hub 三期在昨天开发完了，七七八八加起来又差不多一年，今年和去年相比好的地方体现在：

- 设计器终于和其它系统一样前后端分离了！开发过程中我不用通过 spring-boot thymeleaf 模板引擎写页面了，webpack + vue + es6 + element ui 简直爽翻天了，另外在开发过程中前端团队有了自己的脚手架工具，整个前端团队也沉淀了很多共性组件，把它们抽取出来在整个前端团队中使用，这大大降低了开发时间、提高了开发体验；

- 开发流程终于规范化了，我们在 gitlab 中提交代码，模仿 git-flow 自定义了工作流程（虽然我现在还是觉得 git-flow 就够了），使用 Jenkins 构建 docker 镜像，从 17 开始docker预研，18年部分使用，今年终于全面使用了，这实在是太好了！我们算是工业文明了。另外就是  原型->设计稿->API规范->前后端独立开发，这种模式相比之前简直合理了不知道多少数量级！ 之前的开发流程写得我心惊肉跳。隔壁项目组还在刀耕火种的时代，我们要想办法让他们也用起了，他们以项目开发为主，每次去甲方部署的时候都各种问题，下一阶段要让这套标准在整个团队使用；

再说说不好的地方：

- leader 总是想着充分利用开发人员，不能让他们空下来，结果就是胡乱安排任务，后端都写前端了，写得好没什么问题，结果呢？写了两个系统，两个系统都不能用，我看了一下代码，一个文件有几千行代码，这种项目谁看得懂？改一个 bug 牵扯到那么多代码，我都不敢改。当然这个两个子项目我有很大责任，最开始叫我跟项目，结果我自己的项目太多，我要开发四个系统，维护一个系统，还得跟两个系统，完全没空，等我偶尔空下来来时，发现了很多问题，木已成舟没法改了。我觉得这个问题的主要责任不在后端人员，在 leader，你不能老是想着得干点事、要产出，你应该让合适的人去做合适的事，现在这两个项目怎么办？凑合着用还是改呢？我私下都叫前端团队成员不要管它，这是一个坑。另外再找一个前端开发吧，自从一些同事离职后，项目、产品、数据三个团队前端都吃紧，后端反而都比较完善了，这么多项目，我们几个死活也忙不过来；

- 项目架构的问题，我们项目有很多地方没有理清楚，开发完了后有很多重复的工作，比如：设计器、目录、门户都有数据源管理，并且这个数据源管理还可能被数据团队用到，我们可以把它做成微服务的形式，然后前端页面以微前端的方式组合，这会使得项目开发减少很多重复工作量，另外现在项目已经成熟了，我们没有必要着急开发新功能，可以一步一步扎扎实实的走，可以仔细整理一下项目架构；

- 不能老听需求人员的鬼话。不重要的功能先别开发，设计器开发了那么多组件，最终用到的就那么几个，说不定这还真的符合 2-8定律，我们忙死忙活，结果都没用！做了大量的无用功，最有用的几个却没空优化，结果需求人员还说不好用！这个不好用一部分体现在设计上面，一部分就是花了大量时间做没用的事，别老是想着把项目做大，我们可以有个大的架子，要一步步来，不能一口气全上；

- 说说一些甲方流程、计划的问题，记得上次都下班了，突然说要部署项目第二天演示，运维人员半路赶了回来，那天我很慌，项目都开发完大半年了，我都快忘记了，要不是有事先准备的 docker 镜像，后来才知道甲方那边的要求。他们起码应该提前一两天打声招呼，在需求上面让甲方牵着鼻子走就算了，在计划、流程上还被他们咄咄相逼，我们应该让他们适应我们的流程，这个可能很难，但是我们要建立起这么一个共识，等到一个合适的契机见缝插针，没准就改变了；

- 最后一点就是每次开会我们都讨论了很多东西，很多都可行，开会前我看了一下二期的复盘，大部分问题都已经解决了，但是还是有一些都被慢慢遗忘了，建议指定专门的人去跟踪，可以让特定的人去研究、推广，我们定期对这些问题跟踪、复盘；

就这些吧，又到十一月底了，这一年感谢大家相伴，谢谢。

## 四期相关

**后续：2021 年，四期做了一大部分，还没做完，老大跑路了，然后就没有然后\~\~\~\~**。

不同的地方：

- 使用 typescript 规范的抽象业务组件开发；
- 我们使用 gitlab 替换了 Jenkins；
- 前后端都加了监控功能；
- 完全基于文档编程，先编写 OpenAPI 3 的文档，然后根据文档生成前后端代码，这样减少了接口相关问题；
- 考虑到业务放弃了 k8s；

现在没做产品看，开始做一些项目，我也准备跑路了。

终止与 2021-04-01，大家愚人节快乐！
